<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login Simple - MEP Costa Rica</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h3>
                <i class="fas fa-graduation-cap me-2"></i>Login - Sistema MEP
              </h3>
            </div>
            <div class="card-body">
              <form id="loginForm">
                <div class="mb-3">
                  <label for="correo" class="form-label">Correo:</label>
                  <input
                    type="email"
                    class="form-control"
                    id="correo"
                    value="coordinador@mep.go.cr"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="contrase√±a" class="form-label">Contrase√±a:</label>
                  <input
                    type="password"
                    class="form-control"
                    id="contrase√±a"
                    value="coordinador123"
                    required
                  />
                </div>
                <button type="submit" class="btn btn-primary w-100 mb-2">
                  <i class="fas fa-sign-in-alt me-2"></i>Iniciar Sesi√≥n
                  (auth.js)
                </button>
              </form>

              <button
                type="button"
                class="btn btn-warning w-100"
                onclick="debugLogin()"
              >
                <i class="fas fa-bug me-2"></i>Debug Login (Fetch Directo)
              </button>

              <div id="errorMsg" class="alert alert-danger mt-3 d-none">
                <span id="errorText"></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script type="module">
      import { loginUsuario } from "./auth.js";

      // Login con auth.js
      document
        .getElementById("loginForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const correo = document.getElementById("correo").value;
          const contrase√±a = document.getElementById("contrase√±a").value;
          const errorMsg = document.getElementById("errorMsg");
          const errorText = document.getElementById("errorText");

          try {
            await loginUsuario(correo, contrase√±a);
          } catch (error) {
            console.error("Error login auth.js:", error);
            errorText.textContent = "Error auth.js: " + error.message;
            errorMsg.classList.remove("d-none");
          }
        });
    </script>

    <script>
      // Debug login con fetch directo
      window.debugLogin = async function () {
        const correo = document.getElementById("correo").value;
        const contrase√±a = document.getElementById("contrase√±a").value;
        const errorMsg = document.getElementById("errorMsg");
        const errorText = document.getElementById("errorText");

        console.log("üîç DEBUG LOGIN - Datos:", { correo, contrase√±a });

        try {
          const response = await fetch("http://localhost:4000/api/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ correo, contrase√±a }),
          });

          const data = await response.json();
          console.log("üì° Respuesta:", data);

          if (response.ok && data.token) {
            localStorage.setItem("token", data.token);
            localStorage.setItem("nombre", data.usuario.nombre);
            localStorage.setItem("rol", data.usuario.rol);
            alert("‚úÖ Debug Login exitoso! Redirigiendo...");
            window.location.href = "panel-coordinador-completo.html";
          } else {
            console.error("‚ùå Error:", data);
            errorText.textContent = "DEBUG: " + (data.msg || "Error");
            errorMsg.classList.remove("d-none");
          }
        } catch (error) {
          console.error("‚ùå Error fetch:", error);
          errorText.textContent = "DEBUG Error: " + error.message;
          errorMsg.classList.remove("d-none");
        }
      };
    </script>
  </body>
</html>
